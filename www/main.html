<!DOCTYPE HTML>
<html>

<head>
    <meta charset="UTF-8">
    <title>Main</title>
    <link rel="stylesheet" href="reset.css">
    <link rel="stylesheet" href="styles.css">
    <script src="main.js"></script>

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicons/favicon-16x16.png">
    <link rel="manifest" href="favicons/site.webmanifest">
</head>

<div id="elm-node"></div>
<script>
    var socket = null;

    var app = Elm.Main.init({
        node: document.getElementById('elm-node'),
        flags: [window.innerWidth, window.innerHeight]
    });

    app.ports.connectPort.subscribe(function (url) {
        socket = new WebSocket('ws://' + url);

        socket.onopen = function (_) {
            console.log('CONNECTION OPENED');
            app.ports.connectionOpenedPort.send();
        };

        socket.onmessage = function (event) {
            console.log('ON MESSAGE', event);
            let msg = JSON.parse(event.data);
            app.ports.simUpdatedPort.send(msg);
        }
    });

    app.ports.registerInterestPort.subscribe(function (obj) {
        if (socket) {
            console.log('REGISTER INTEREST', obj);
            let msg = JSON.stringify(obj);
            app.ports.connectionOpenedPort.send(msg);
        }
    });

</script>

</html>